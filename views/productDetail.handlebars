<div class="product-detail">
  <div class="row">
    <div class="col-md-6">
      <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          {{#each product.thumbnails}}
            <div class="carousel-item {{#if @first}}active{{/if}}">
              <img src="{{this}}" class="d-block w-100" alt="{{../product.title}}">
            </div>
          {{else}}
            <div class="carousel-item active">
              <div class="d-block w-100 bg-light" style="height: 400px; display: flex; align-items: center; justify-content: center;">
                <span class="text-muted">No hay im√°genes disponibles</span>
              </div>
            </div>
          {{/each}}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
        </button>
      </div>
    </div>
    <div class="col-md-6">
      <h1>{{product.title}}</h1>
      <p class="text-muted">{{product.category}}</p>
      <h3 class="text-success my-4">${{product.price}}</h3>
      
      <div class="mb-4">
        <span class="badge bg-{{#if (gt product.stock 0)}}success{{else}}danger{{/if}}">
          {{#if (gt product.stock 0)}}
            {{product.stock}} disponibles
          {{else}}
            Agotado
          {{/if}}
        </span>
      </div>
      
      <p>{{product.description}}</p>
      
      <div class="d-flex gap-2 mt-4">
        <button onclick="addToCart('{{product._id}}')" class="btn btn-primary btn-lg" {{#unless (gt product.stock 0)}}disabled{{/unless}}>
          Agregar al carrito
        </button>
        <a href="/" class="btn btn-outline-secondary btn-lg">Volver</a>
      </div>
    </div>
  </div>
</div>

<script>
  function addToCart(productId) {
    fetch('/api/carts/{{cartId}}/products/' + productId, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (response.ok) {
        alert('Producto agregado al carrito');
      } else {
        response.json().then(data => {
          alert('Error: ' + data.message);
        });
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error al agregar al carrito');
    });
  }
</script>